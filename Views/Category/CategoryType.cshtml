@model IEnumerable<ShoppingCartAdminMetronic.Models.Product>

@{
    ViewData["Title"] = "CategoryType";
}

<div class="card card-flush h-xl-100">
    <!--begin::Header-->
    <div class="card-header pt-5">
        <!--begin::Title-->
        <h3 class="card-title align-items-start flex-column">			
            <span class="card-label fw-bold text-gray-800">Categories</span>

            <span class="text-gray-400 mt-1 fw-semibold fs-6">Select the category to view it's items</span>
        </h3>
        <!--end::Title-->

        @if (ViewBag.Admin=="true"){
            <!--begin::Toolbar-->
                <div class="card-toolbar">            
                    <!--begin::Menu-->
                    <button class="btn btn-icon btn-color-gray-400 btn-active-color-primary justify-content-end" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-overflow="true">                
                        <i class="ki-duotone ki-dots-square fs-1 text-gray-400 me-n1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></i>                             
                    </button>


                    <!--begin::Menu 2-->
                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px" data-kt-menu="true">
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <div class="menu-content fs-6 text-dark fw-bold px-3 py-4">Quick Actions</div>
                        </div>
                        <!--end::Menu item-->

                        <!--begin::Menu separator-->
                        <div class="separator mb-3 opacity-75"></div>
                        <!--end::Menu separator-->

                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link px-3">
                                New Ticket
                            </a>
                        </div>
                        <!--end::Menu item-->

                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link px-3">
                                New Customer
                            </a>
                        </div>
                        <!--end::Menu item-->

                        <!--begin::Menu item-->
                        <div class="menu-item px-3" data-kt-menu-trigger="hover" data-kt-menu-placement="right-start">
                            <!--begin::Menu item-->
                            <a href="#" class="menu-link px-3">
                                <span class="menu-title">New Group</span>
                                <span class="menu-arrow"></span>
                            </a>
                            <!--end::Menu item-->

                            <!--begin::Menu sub-->
                            <div class="menu-sub menu-sub-dropdown w-175px py-4">
                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Admin Group
                                    </a>
                                </div>
                                <!--end::Menu item-->

                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Staff Group
                                    </a>
                                </div>
                                <!--end::Menu item-->

                                <!--begin::Menu item-->            
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Member Group
                                    </a>
                                </div>
                                <!--end::Menu item-->
                            </div>
                            <!--end::Menu sub-->
                        </div>
                        <!--end::Menu item-->

                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link px-3">
                                New Contact
                            </a>
                        </div>
                        <!--end::Menu item-->

                        <!--begin::Menu separator-->
                        <div class="separator mt-3 opacity-75"></div>
                        <!--end::Menu separator-->

                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <div class="menu-content px-3 py-3">
                                <a class="btn btn-primary  btn-sm px-4" href="#">
                                    Generate Reports
                                </a>
                            </div>
                        </div>
                        <!--end::Menu item-->
                    </div>
                    <!--end::Menu 2-->

                    <!--end::Menu-->             
                </div>
            <!--end::Toolbar-->
        }
    </div>
    <!--end::Header-->

    <!--begin::Body-->
    <div class="card-body pt-6">
        <!--begin::Nav-->             
        <ul class="nav nav-pills nav-pills-custom mb-3" role="tablist">
            @{
            int index = 0;
            foreach(var c in ViewBag.Categories){
                <!--begin::Item-->
                //<a href="~/Category/CategoryType/@c.Id">
                <li class="nav-item mb-3 me-3 me-lg-6" role="presentation">
                        <a class="nav-link btn btn-outline btn-flex btn-color-muted btn-active-color-primary flex-column overflow-hidden w-80px h-85px pt-5 pb-2
                       @(Model.Any() && c.Id == Model.First().CategoryId ? "active" : "")"
                       id="@c.Id"
                       asp-controller="Category" 
                        asp-action="CategoryType" 
                        asp-route-name="@c.Name" 
                        aria-selected="true" 
                        role="tab">
                    <!--begin::Link-->
                        <!--begin::Icon-->
                        <div class="nav-icon mb-3">
                            <i class="ki-duotone ki-car fs-1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                        </div>
                        <!--end::Icon-->
                        <!--begin::Title-->
                        <span class="nav-text text-gray-800 fw-bold fs-6 lh-1">
                            @c.Name
                        </span>
                        <!--end::Title-->
                        <!--begin::Bullet-->
                        <span class="bullet-custom position-absolute bottom-0 w-100 h-4px bg-primary"></span>
                        <!--end::Bullet-->
                    </a>
                    <!--end::Link-->
                </li>
                //</a>
                    <!--end::Item-->
                    index++;
                }
            }
        </ul>             
        <!--end::Nav-->
        <div style="flex-wrap: wrap; display: flex;">
            @foreach (var p in Model)
            {
            
                    <div class="product-wrapper">
                    <div class="product-container">
                        <img src="~/media/products/@p.ThumbnailImage" class="product-top">
                        <div class="product-bottom">
                            <div class="product-left">
                                <div class="product-details">
                                    <h1 class="product-title">@p.Name</h1>
                                    <p>@p.Price.ToString("C2")</p>
                                </div>
                                <div data-id="@p.Id" class="product-buy"><i class="material-icons">add_shopping_cart</i></div>
                            </div>
                            <div class="product-right">
                                <div class="product-done"><i class="material-icons">done</i></div>
                                <div class="product-details">
                                    <h1 class="product-title">@p.Name</h1>
                                    <p>Added to your cart</p>
                                </div>
                                <div data-id="@p.Id" class="product-remove"><i class="material-icons">clear</i></div>
                            </div>
                        </div>
                    </div>
                    <div class="inside">
                        <div class="product-icon"><i class="material-icons">info_outline</i></div>
                        <div class="product-contents">
                            <table>
                                <tr>
                                    <th>Description</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <td>@p.Description</td>
                                    <td>4000mm</td>
                                </tr>
                                <tr>
                                    <th>Something</th>
                                    <th>Something</th>
                                </tr>
                                <tr>
                                    <td>200mm</td>
                                    <td>200mm</td>
                                </tr>
                                <tr>
                                    <th>Something</th>
                                    <th>Something</th>
                                </tr>
                                <tr>
                                    <td>200mm</td>
                                    <td>200mm</td>
                                </tr>
                                <tr>
                                    <th>Something</th>
                                    <th>Something</th>
                                </tr>
                                <tr>
                                    <td>200mm</td>
                                    <td>200mm</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            }
        </div>


        @if (ViewBag.Cart != null)
        {
            <script>
                var cartItems = @Html.Raw(Json.Serialize(ViewBag.Cart));
                console.log("I am after HTML Raw!!");


                cartItems.forEach(function (item) {

                    console.log("I am in foreach!!");
                    var elements = document.querySelectorAll('.product-buy');


                    elements.forEach(function (element) {
                        var dataId = element.getAttribute('data-id');
                        console.log("dataId: " + dataId);
                        console.log("ProductId: " + item.productId);
                        console.log("item: " + JSON.stringify(item));

                        if (dataId == item.productId) {
                            element.closest('.product-bottom').classList.add("product-clicked");
                            console.log('Match found:', element);
                        }
                    });

                })
            </script>
        }


    </div>
    <!--end: Card Body-->
</div>