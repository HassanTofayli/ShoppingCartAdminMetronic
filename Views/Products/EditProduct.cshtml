@model ShoppingCartAdminMetronic.Models.Product

@{
	ViewData["Title"] = "Add Product";
}


<style>


	.custom-file-upload {
		cursor: pointer;
		background-color: #f0f0f0;
		padding: 10px 15px;
		border: 1px solid #ccc;
		border-radius: 5px;
		display: inline-block;
		margin-top: 10px;
		color: #333;
	}

	/* Style for the selected file names */
	#file-list {
		margin-top: 10px;
	}
</style>


<div class="card mb-5 mb-xl-10">
	<div class="app-main flex-column flex-row-fluid mb-5" id="kt_app_main">
		<div class="d-flex flex-column flex-column-fluid">

			<div id="kt_app_toolbar" class="app-toolbar  py-3 py-lg-6 ">
			</div>
			<div id="kt_app_content" class="app-content  flex-column-fluid ">


				<div id="kt_app_content_container" class="app-container  container-xxl ">
					<form asp-controller="Products" asp-action="EditProduct" id="kt_ecommerce_add_product_form" class="form d-flex flex-column flex-lg-row" method="post" enctype="multipart/form-data">
						
						
						<div class="d-flex flex-column gap-7 gap-lg-10 w-100 w-lg-300px mb-7 me-lg-10">


							<!--begin::Thumbnail settings-->
							<div class="card card-flush py-4">
								<!--begin::Card header-->
								<div class="card-header">
									<!--begin::Card title-->
									<div class="card-title">
										<h2>Thumbnail</h2>
									</div>
									<!--end::Card title-->
								</div>
								<!--end::Card header-->
								<!--begin::Card body-->
								<div class="card-body text-center pt-0">
									
									<div class="image-input image-input-empty image-input-outline image-input-placeholder mb-3" data-kt-image-input="true" style="display: flex;flex-direction: column;align-items: center;">
										<!--begin::Preview existing avatar-->
										<img src="~/media/products/@Model.ThumbnailImage" class="image-input-wrapper w-150px h-150px" id="existingImage"></img>
										<div class="image-input-wrapper w-150px h-150px" style="display:none;" id="imagepreview1"></div>
										<!--end::Preview existing avatar-->
										<!--begin::Label-->
										<label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="change" data-bs-toggle="tooltip" title="Change avatar">
											<i class="ki-duotone ki-pencil fs-7"><span class="path1"></span><span class="path2"></span></i>
											<input asp-for="ImageUpload" type="file" name="ImageUpload" accept=".png, .jpg, .jpeg" id="ImageUpload">
										</label>
										<span asp-validation-for="ImageUpload" class="text-danger"></span>
										<!--end::Label-->
										<!--begin::Cancel-->
										<div id="removeIcon">
										<span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="cancel" data-bs-toggle="tooltip" aria-label="Cancel avatar" data-bs-original-title="Cancel avatar" data-kt-initialized="1">
											<i class="ki-duotone ki-cross fs-2"><span class="path1"></span><span class="path2"></span></i>
										</span>
										</div>
										<!--end::Cancel-->
										<!--begin::Remove-->
										
										<span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow" data-kt-image-input-action="remove" data-bs-toggle="tooltip" aria-label="Remove avatar" data-bs-original-title="Remove avatar" data-kt-initialized="1">
											<i class="ki-duotone ki-cross fs-2"><span class="path1"></span><span class="path2"></span></i>
										</span>
										
										<!--end::Remove-->
									</div>
									<!--end::Image input-->
									<!--begin::Description-->
									<div class="text-muted fs-7">Set the product thumbnail image. Only *.png, *.jpg and *.jpeg image files are accepted</div>
									<!--end::Description-->
								</div>
								<!--end::Card body-->
							</div>
							<!--end::Thumbnail settings-->



							<!--begin::Category & tags-->
							<div class="card card-flush py-4">
								<!--begin::Card header-->
								<div class="card-header">
									<!--begin::Card title-->
									<div class="card-title">
										<h2>Product Details</h2>
									</div>
									<!--end::Card title-->
								</div>
								<!--end::Card header-->
								<!--begin::Card body-->
								<div class="card-body pt-0">
									<!--begin::Input group-->
									<!--begin::Label-->
									<label class="form-label">Categories</label>
									<!--end::Label-->
									<!--begin::Select-->
									<select asp-for="CategoryId" class="form-control" asp-items="ViewBag.Categories">
										<option value="0">Choose a category</option>
									</select>
									<span asp-validation-for="CategoryId" class="text-danger"></span>
									<!--end::Select-->
									<!--begin::Description-->
									<div class="text-muted fs-7 mb-7">Add product to a category.</div>
									<!--end::Description-->
									<!--end::Input group-->
									<!--begin::Button-->
									<a href="/metronic8/demo1/../demo1/apps/ecommerce/catalog/add-category.html" class="btn btn-light-primary btn-sm mb-10">
										<i class="ki-duotone ki-plus fs-2"></i>            Create new category
									</a>
									<!--end::Button-->
									<!--begin::Input group-->
									<!--begin::Label-->
									<label class="form-label d-block">Tags</label>
									<!--end::Label-->
									<!--begin:: Tags Input-->
									@*<input list="suggestions" type="text" id="tagInput" asp-for="Tags" placeholder="Type tag and press Enter">
									<datalist id="suggestions">
									<!-- Filled dynamically -->
									</datalist>
									<ul id="tagList"></ul>*@




									<!--end:: Tags Input-->
									<!--begin::Description-->
									<div class="text-muted fs-7">Add tags to a product.</div>
									<!--end::Description-->
									<!--end::Input group-->
								</div>
								<!--end::Card body-->
							</div>
							<!--end::Category & tags-->

							<p>@ViewBag.deletedImagesListFromController;</p>
						</div>


						<!--begin::Main column-->
						<div class="d-flex flex-column flex-row-fluid gap-7 gap-lg-10">

							<!--begin:::Tabs-->
							<ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-semibold mb-n2">
								<!--begin:::Tab item-->
								<li class="nav-item">
									<a class="nav-link text-active-primary pb-4 active" data-bs-toggle="tab" href="#kt_ecommerce_add_product_general">General</a>
								</li>
								<!--end:::Tab item-->
							</ul>
							<!--end:::Tabs-->
							<!--begin::Tab content-->
							<div class="tab-content">
								<!--begin::Tab pane-->
								<div class="tab-pane fade show active" id="kt_ecommerce_add_product_general" role="tab-panel">
									<div class="d-flex flex-column gap-7 gap-lg-10">

										<!--begin::General options-->
										<div class="card card-flush py-4">

											<!--begin::Card header-->
											<div class="card-header">
												<div class="card-title">
													<h2>General</h2>
												</div>
											</div>
											<!--end::Card header-->
											<!--begin::Card body-->
											<div class="card-body pt-0">
												<!--begin::Product Name Input group-->
												<div class="mb-10 fv-row">

													<label asp-for="Name" class="control-label required form-label">Product Name</label>
													<input asp-for="Name" class="form-control" placeholder="Product name" />
													<span asp-validation-for="Name" class="text-danger"></span>
													<div class="text-muted fs-7">A product name is required and recommended to be unique.</div>

												</div>
												<!--end:: Product Name Input group-->
												<div>
													<label class="form-label">Description</label>
													<div id="kt_ecommerce_add_product_description" class="editor min-h-200px mb-2"></div>
													<div id="initial-content" style="display:none;">@Html.Raw(Model.Description)</div>
													<div class="text-muted fs-7">Set a description to the product for better visibility.</div>
													<input type="hidden" id="hiddenDescription" asp-for="Description">
												</div>
												<!--end:: Description Input group-->
											</div>
											<!--end::Card header-->
										</div>
										<!--end::General options-->



										<!--begin::Media-->
										<div class="card card-flush py-4">
											<div class="card-header">
												<div class="card-title">
													<h2>Media</h2>
												</div>
											</div>
											@if (ViewBag.ImagesList != null)
											@foreach (var p in ViewBag.ImagesList)
											{

												<div class="border border-dashed border-gray-300 rounded px-7 py-3 mb-6 mediaImage">
													<div class="d-flex flex-stack mb-3">
														<div class="me-3">
															<img src="~/media/products/@p.url" width="150px" class="ms-n1 me-1" alt="" />
														</div>
															<div  class="m-0 ">
																<span data-image-id="@p.Id" class="remove-button btn btn-icon btn-color-gray-400 btn-active-color-primary justify-content-end ">
																<i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
															</span>
														</div>
													</div>
												</div>

											}
											<div class="card-body pt-0">
												<div class="fv-row mb-2">
													<label asp-for="ImageUploads" class="custom-file-upload">
														Add Files
													</label>
													<input asp-for="ImageUploads" type="file" multiple>

												</div>
												<div id="file-list" class="text-muted fs-7">No files selected</div>
											</div>
										</div>
										<!--end::Media-->




										<!--begin::Pricing-->
										<div class="card card-flush py-4">
											<!--begin::Card header-->
											<div class="card-header">
												<div class="card-title">
													<h2>Pricing</h2>
												</div>
											</div>
											<!--end::Card header-->
											<!--begin::Card body-->
											<div class="card-body pt-0">
												<!--begin::Input group-->
												<div class="mb-10 fv-row">
													<label asp-for="Price" class="control-label required form-label"></label>
													<input asp-for="Price" class="form-control mb-2" placeholder="Product price" />
													<span asp-validation-for="Price" class="text-danger"></span>

													<!--begin::Description-->
													<div class="text-muted fs-7">Set the product price.</div>
													<!--end::Description-->
												</div>
												<!--end::Input group-->
											</div>
											<!--end::Card header-->
										</div>
										<!--end::Pricing-->


									</div>
								</div>
								<!--end::Tab pane-->
							</div>
							<!--end::Tab content-->
							<input type="hidden" id="DeletedImages" name="DeletedImages">
							<div class="d-flex justify-content-end">
								<!--begin::Button-->
								<a asp-controller="Products" asp-action="Index" id="kt_ecommerce_add_product_cancel" class="btn btn-light me-5">
									Cancel
								</a>
								<!--end::Button-->
								<!--begin::Button-->
								<button type="submit" id="kt_ecommerce_add_product_submit" class="btn btn-primary">
									<span class="indicator-label">
										Save Changes
									</span>
									<span class="indicator-progress">
										Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
									</span>
								</button>
								<!--end::Button-->
							</div>
						</div>
						<!--end::Main column-->
					</form>
					<!--end::Form-->
				</div>
				<!--end::Content container-->
			</div>
			<!--end::Content-->

		</div>
		<!--end::Content wrapper-->

	</div>
	<!--end:::Main-->

</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		var quill = new Quill('.editor', {
			theme: 'snow'
		});

		var initialContent = document.getElementById('initial-content').innerHTML;
		quill.clipboard.dangerouslyPasteHTML(initialContent);

		// Listen for changes on the editor
		quill.on('text-change', function (delta, oldDelta, source) {
			var descriptionContent = quill.root.innerHTML;
			document.getElementById("hiddenDescription").value = descriptionContent;
		});
	});

</script>




<script>

	document.addEventListener('DOMContentLoaded', function () {
		const ImageUpload = document.getElementById('ImageUpload');
		const existingImage = document.getElementById('existingImage');
		const existingImageUrl = existingImage.src;
		const imagePreview = document.getElementById('imagepreview1');
		const thumbnailRemoveButton = document.getElementById('removeIcon');
		const submitButton = document.getElementById('kt_ecommerce_add_product_submit');
		const DeletedImagesInput = document.getElementById('DeletedImages');
		var deletedImages = [];
		var removeButtons = document.querySelectorAll('.remove-button');

		ImageUpload.addEventListener('change', function (event) {
			const fileList = event.target.files;

			if (fileList.length > 0) {
				const reader = new FileReader();

				reader.addEventListener('load', function (event) {
					existingImage.src = event.target.result;
				});

				reader.readAsDataURL(fileList[0]);
			}
		});
		
		//thumbnail Remove Button
		thumbnailRemoveButton.addEventListener('click', function () {
			existingImage.src = existingImageUrl;
			ImageUpload.value = null; 
		});

		removeButtons.forEach(function(i){

			i.addEventListener('click', function(){
				var imageElement = this.closest('.mediaImage').querySelector('img');
				var mediaElement = this.closest('.mediaImage');
				var removedImageUrl = imageElement.src;
				var removedImageId = this.getAttribute('data-image-id');
				deletedImages.push({ id: removedImageId, url: removedImageUrl });
				mediaElement.style.display = 'none';
				@ViewBag.Ima
			});
		
		});

		submitButton.addEventListener('click', function()
		{			
			const deletedImagesJsonString = JSON.stringify(deletedImages);
			DeletedImagesInput.value = deletedImagesJsonString;
			console.log(deletedImagesJsonString);
		});
	});
</script>